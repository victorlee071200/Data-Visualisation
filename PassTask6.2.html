<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Data Visualisation" />
    <meta name="keywords" content="HTML, CSS, D3" />
    <meta name="author" content="Lee Zhe Sheng" />
    <title>Task 6.2 D3 Interactivity - Sort</title>

    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>
    <h1>Bar Chart with Mouse Over and Sort</h1>
    <button class="button">Add</button>
    <button class="button2">Remove</button>
    <button id="sort">Sort</button>
    <br />

    <script>
      var w = 500;
      var h = 100;
      var maxValue = 25;
      var barpadding = 1;
      var dataset = [14, 5, 26, 23, 9, 10, 30, 16, 20];

      var xScale = d3
        .scaleBand()
        .domain(d3.range(dataset.length))
        .rangeRound([0, w])
        .paddingInner(0.05);

      var yScale = d3
        .scaleLinear()
        .domain([0, d3.max(dataset)])
        .range([0, h]);

      var svg = d3.select("body").append("svg").attr("width", w).attr("height", h);

      /*Creating a rectangle*/
      svg
        .selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("x", function (d, i) {
          return xScale(i);
        })
        .attr("y", function (d) {
          return h - yScale(d); /* flip the bar chart*/
        })
        .attr("width", xScale.bandwidth())
        .attr("height", function (d) {
          return yScale(d);
        })

        .style("fill", "grey");

      d3.select(".button").on("click", function () {
        var newNumber = Math.floor(Math.random() * maxValue);
        dataset.push(newNumber);
        xScale.domain(d3.range(dataset.length));
        var bars = svg.selectAll("rect").data(dataset);
        bars
          .enter()
          .append("rect")
          .attr("x", w)
          .attr("y", function (d) {
            return h - yScale(d); /* flip the bar chart*/
          })
          .style("fill", "grey")
          .merge(bars)
          .transition()
          .duration(500)
          .attr("x", function (d, i) {
            return xScale(i);
          })
          .attr("y", function (d) {
            return h - yScale(d); /* flip the bar chart*/
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function (d) {
            return yScale(d);
          });
      });

      d3.select(".button2").on("click", function () {
        //var newNumber = Math.floor(Math.random()* maxValue);
        //dataset.push(newNumber);
        dataset.shift();
        xScale.domain(d3.range(dataset.length));
        var bars = svg.selectAll("rect").data(dataset);
        bars
          .enter()
          .append("rect")
          .attr("x", w)
          .attr("y", function (d) {
            return h - yScale(d); /* flip the bar chart*/
          })
          .merge(bars)
          .transition()
          .duration(500)
          .attr("x", function (d, i) {
            return xScale(i);
          })
          .attr("y", function (d) {
            return h - yScale(d); /* flip the bar chart*/
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function (d) {
            return yScale(d);
          });

        bars.exit().transition().duration(500).attr("x", w).remove();
      });

      d3.select("#sort").on("click", function () {
        sortBars();
      });

      var sortOrder = false;

      var sortBars = function () {
        sortOrder = !sortOrder;
        svg
          .selectAll("rect")
          .sort(function (a, b) {
            if (sortOrder) {
              return d3.ascending(a, b);
            } else {
              return d3.descending(a, b);
            }
          })
          .transition()
          .duration(1000)
          .attr("x", function (d, i) {
            return xScale(i);
          });
      };
    </script>

    <br />

    <footer style="color: grey">
      COS30045 Data Visualisation<br />Lee Zhe Sheng (101215371)
    </footer>
  </body>
</html>
